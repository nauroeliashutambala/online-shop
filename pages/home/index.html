<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/css/style.css">
    <title>Document</title>
    <!-- Adiciona no <head> do HTML -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />

</head>

<body>
    <nav>
        <div class="logo">
            <h2>M<span>Shop</span></h2>
        </div>

        <img src="" alt="" srcset="" onclick="abrir_menu()">
        <ul class="lista_menu">
            <!-- <li><a href="#">Inicio</a></li> -->
        </ul>
    </nav>
    <div class="principal">
        <div class="menu open">

        </div>
        <main id="main">
            <form class="search">
                <input name="search" type="search" id="search_input" placeholder="Pesquise por algo aqui...">
                <select name="filter" id="filtro">
                    <option value="Todos" disabled selected>Geral</option>
                </select>
                <button type="submit"></button>
            </form>

            <!-- Banner -->
            <div class="banner">
                <img src="assets/img/nauroo.jpg" alt="Promoção">
                <div class="banner-content">
                    <div class="banner-title">80% DESCONTO</div>
                    <div class="banner-subtitle">Ganhe descontos grandes e ache o ideal para ti</div>
                    <button class="banner-button">Avaliar</button>
                </div>
            </div>
            <div class="container_cards" id="container_cards">
                <div class="list" id="lista_de_cards">

                </div>
            </div>
        </main>
    </div>

    <script src="assets/js/list.js"></script>
    <script src="assets/js/menus.js"></script>
    <script src="assets/js/search.js"></script>

    <script>
        const searchInput = document.getElementById("search_input");

        async function carregarProdutos() {
            const resposta = await fetch('get_products.php');
            const produtos = await resposta.json();

            const container = document.getElementById('lista_de_cards');
            if (!container) return;

            container.innerHTML = '';
            produtos.forEach(prod => {
                container.innerHTML += `
                ${gera_cards(prod.id, prod.nome, prod.imagem, prod.preco)}
            `;
            });
        }

        async function pesquisar_Produtos(conteudo) {
            const resposta = await fetch(`get_products.php?search=${encodeURIComponent(conteudo)}`);
            const produtos = await resposta.json();

            const container = document.getElementById('lista_de_cards');
            if (!container) return;

            container.innerHTML = '';
            produtos.forEach(prod => {
                container.innerHTML += `
                ${gera_cards(prod.id, prod.nome, prod.imagem, prod.preco)}
            `;
            });

            const banner = document.querySelector(".banner");
            if (banner) {
                if (conteudo.length > 0) {
                    banner.classList.add("display_none");
                } else {
                    banner.classList.remove("display_none");
                }
            }
        }

        // Função para “live search”
        searchInput.addEventListener("input", () => {
            const termo = searchInput.value.trim();
            if (termo.length > 0) {
                pesquisar_Produtos(termo);
            } else {
                carregarProdutos();
            }
        });

        // Ao carregar a página, decide se pesquisa ou carrega tudo
        document.addEventListener("DOMContentLoaded", () => {
            const params = new URLSearchParams(window.location.search);
            if (params.has("search")) {
                const termo = params.get("search");
                searchInput.value = termo; // preenche o campo
                pesquisar_Produtos(termo);
            } else {
                carregarProdutos();
            }
        });
    </script>


</body>

</html>